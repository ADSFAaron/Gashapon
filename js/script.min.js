const rangeWrapper=document.querySelector("body");let mouseClick_Y=0,mouseMove_Y=0,mouseState=0,modalState=0,gashaponScale_X=0,gashaponScale_Y=0,windowsHeight=document.body.clientHeight,triggerHeight=windowsHeight/4,itemId=["#e0dj51prVt431_to","#e0dj51prVt432_to","#e0dj51prVt433_to","#e0dj51prVt434_to","#e0dj51prVt435_to","#e0dj51prVt438_tr","#e0dj51prVt439_tr","#e0dj51prVt440_tr","#e0dj51prVt441_tr","#e0dj51prVt442_tr","#e0dj51prVt443_tr","#e0dj51prVt444_tr","#e0dj51prVt445_tr","#e0dj51prVt446_tr","#e0dj51prVt447_tr","#e0dj51prVt448_tr","#e0dj51prVt449_tr","#e0dj51prVt450_tr","#e0dj51prVt451_tr","#e0dj51prVt452_tr","#e0dj51prVt455_to","#e0dj51prVt455_tr","#e0dj51prVt458_to","#e0dj51prVt458_tr","#e0dj51prVt461_to","#e0dj51prVt461_tr","#e0dj51prVt464_to","#e0dj51prVt464_tr","#e0dj51prVt467_to","#e0dj51prVt467_tr","#e0dj51prVt470_to","#e0dj51prVt470_tr","#e0dj51prVt473_to","#e0dj51prVt473_tr","#e0dj51prVt476_to","#e0dj51prVt476_tr","#e0dj51prVt479_to","#e0dj51prVt479_tr","#e0dj51prVt482_to","#e0dj51prVt482_tr","#e0dj51prVt485_to","#e0dj51prVt485_tr","#e0dj51prVt488_to","#e0dj51prVt488_tr"],dropGashaponId=["#e0dj51prVt428_to","#e0dj51prVt428_tr","#e0dj51prVt428_ts","#e0dj51prVt428","#XXX_to","#XXX_tr","#XXX_ts","#XXX"],dropGashaponColor=["#ff8271","#ca8ff7","#ffd278","#b7dd87","#9db1ef"],modalBackground=["#f7524b","#a159d9","#f5ad56","#accf4e","#6685e3"];function gashaponAnimation(state){const rootStyle=document.documentElement.style;"play"===state?(rootStyle.setProperty("--play-number","1"),rootStyle.setProperty("--play-state","running"),itemId.forEach((id=>{document.querySelector(id).style.animationName=""}))):"stop"===state?(rootStyle.setProperty("--play-number","0"),rootStyle.setProperty("--play-state","paused"),itemId.forEach((id=>{document.querySelector(id).style.animationName="unset"}))):"drop"===state&&(getRandomGashapon(),rootStyle.setProperty("--play-number-drop","1"),rootStyle.setProperty("--play-state-drop","running"),dropGashaponId.forEach((id=>{document.querySelector(id).style.animationName=""})),setTimeout((()=>{rootStyle.setProperty("--play-number-drop","0"),rootStyle.setProperty("--play-state-drop","paused"),dropGashaponId.forEach((id=>{document.querySelector(id).style.animationName="unset"}))}),3e3))}function gashaponScale(state){const gashaponMain=document.querySelector(".gashapon-main"),energyBar=document.querySelector(".energy-bar");"reset"===state&&(gashaponMain.style.transition="",gashaponMain.style.transform=""),"rebound-short"===state&&(gashaponMain.style.transition="1s",gashaponMain.style.transform="scale(1.05, 0.95)",setTimeout((()=>{gashaponMain.style.transform="",energyBar.style.transition="",gashaponMain.classList.add("default-animation")}),1e3)),"rebound-high"===state&&(gashaponMain.style.transition="1s",gashaponMain.style.transform="scale(0.95, 1.05)",setTimeout((()=>{gashaponMain.style.transform="",energyBar.style.transition="",gashaponMain.classList.add("default-animation")}),1e3)),"reduction"===state&&(gashaponMain.style.transition="1s",gashaponMain.style.transform="",gashaponMain.classList.add("default-animation"))}function getRandomGashapon(){const r=getRandom(dropGashaponColor.length)-1;document.querySelector("#drop-gashapon").style.fill=dropGashaponColor[r],document.querySelector("#drop-gashapon-m").style.fill=dropGashaponColor[r],document.querySelector(".modal-header").style.background=modalBackground[r]}function getTriggerHeight(){windowsHeight=document.body.clientHeight,triggerHeight=windowsHeight/4,console.log(triggerHeight)}function mouseDown(e){document.querySelector(".curzr .outer").style.fill="#f6c0bb",0==modalState&&(getTriggerHeight(),document.querySelector(".energy-bar").style.transition="0s",gashaponScale("reset"),gashaponAnimation("stop"),mouseClick_Y=e.pageY,void 0===e.pageY&&(mouseClick_Y=e.touches[0].pageY),mouseState=1)}function mouseMove(e){if(1==mouseState&&0==modalState){const gashaponMain=document.querySelector(".gashapon-main");gashaponMain.classList.remove("default-animation");let Y=e.pageY;void 0===Y&&(Y=e.touches[0].pageY),mouseMove_Y=mouseClick_Y-Y,gashaponScale_X=-(5e-4*mouseMove_Y-1),gashaponScale_Y=.001*mouseMove_Y+1;const gashaponScale_CSS=`scale(${gashaponScale_X},${gashaponScale_Y})`;gashaponMain.style.transform=gashaponScale_CSS,(mouseMove_Y<-30||mouseMove_Y>30)&&closeMenu();const energyBar=document.querySelector(".energy-bar"),hintEnergy=document.querySelector(".hint-text .energy"),hintText=document.querySelector(".hint-text .text");mouseMove_Y<0?(energyBar.style.transform=`scaleY(${mouseMove_Y/(-1*triggerHeight)})`,hintEnergy.style.transform=`scaleX(${mouseMove_Y/(-1*triggerHeight)})`,mouseMove_Y<-triggerHeight&&(hintText.textContent="可放開扭蛋機")):mouseMove_Y>0?(energyBar.style.transform=`scaleY(${mouseMove_Y/triggerHeight})`,hintEnergy.style.transform=`scaleX(${mouseMove_Y/triggerHeight})`,mouseMove_Y>triggerHeight&&(hintText.textContent="可放開扭蛋機")):hintText.textContent="請持續滑動"}}function mouseUp(e){document.querySelector(".curzr .outer").style.fill="",document.querySelector(".energy-bar").style.transition="1s",document.querySelector(".energy-bar").style.transform="scaleY(0)",document.querySelector(".hint-text .energy").style.transition="0.2s",document.querySelector(".hint-text .energy").style.transform="scaleX(0)",1==mouseState&&(mouseMove_Y<=0&&mouseMove_Y<-100?(gashaponScale("rebound-high"),document.querySelector(".hint-text .text").textContent="按住螢幕滑動"):mouseMove_Y>0&&mouseMove_Y>100?(gashaponScale("rebound-short"),document.querySelector(".hint-text .text").textContent="按住螢幕滑動"):(gashaponScale("reduction"),document.querySelector(".hint-text .text").textContent="按住螢幕滑動"),(mouseMove_Y<-1*triggerHeight||mouseMove_Y>triggerHeight)&&(modalState=1,gashaponAnimation("play"),setTimeout((function(){gashaponAnimation("drop")}),1250),document.querySelector(".hint-text .text").textContent="顯示結果",showResultModal())),mouseState=0,mouseMove_Y=0}function showResultModal(){setTimeout((function(){if(void 0===dataObjectArray||0===importState){new bootstrap.Modal(document.getElementById("import-modal")).show();const cancelButton=document.getElementById("import-modal-cancel");cancelButton&&cancelButton.addEventListener("click",(function(){modalState=0;const hintTextElement=document.querySelector(".hint-text .text");0===importState?hintTextElement.textContent="資料尚未匯入":hintTextElement.textContent="按住螢幕滑動"}))}else{printResultText(),new bootstrap.Modal(document.getElementById("result-modal")).show()}}),3e3)}function printResultText(){const resultContent=document.querySelector(".modal-body .result-content");let r;if(resultContent.innerHTML="",document.querySelector(".modal-body-result .modal-no-data").style.display="none",1===repeatDrawState)console.log("重複抽獎"),r=getRandom(dataObjectArray.length)-1;else if(0===repeatDrawState){console.log("不重複抽獎");if(dataObjectArray.every((item=>item.itemIsDrawn)))return console.log("全部都抽完"),void(document.querySelector(".modal-body-result .modal-no-data").style.display="block");do{r=getRandom(dataObjectArray.length)-1}while(dataObjectArray[r].itemIsDrawn)}console.log(dataObjectArray,r),dataObjectArray[r].itemCount++,0===repeatDrawState&&(dataObjectArray[r].itemIsDrawn=!0),printGachaList(),historyList.push(dataObjectArray[r][csvList[0][0]]),printHistoryList(),document.querySelectorAll(".gacha-list .item").forEach((item=>item.classList.remove("active"))),document.getElementById(dataObjectArray[r].itemId).classList.add("active");const csvObjectKey=csvList[0],csvObjectKeyLength=csvObjectKey.length;csvObjectKey.forEach((itemTitle=>{const itemInfo=dataObjectArray[r][itemTitle];csvObjectKeyLength>1||"地址"===itemTitle||"圖片"===itemTitle?"地址"===itemTitle?resultContent.innerHTML+=`<p>${itemTitle}：<a href='https://www.google.com/maps/place/${itemInfo}' target='_blank'>${itemInfo}</a></p>`:"圖片"===itemTitle?resultContent.innerHTML+=`<img src='${itemInfo}' class='result-img'>`:isURL(itemInfo)?isImageURL(itemInfo)?resultContent.innerHTML+=`<p>${itemTitle}</p><img src='${itemInfo}' class='result-img'>`:resultContent.innerHTML+=`<p>${itemTitle}：<a href='${itemInfo}' target='_blank'>${itemInfo}</a></p>`:resultContent.innerHTML+=`<p>${itemTitle}：${itemInfo}</p>`:resultContent.innerHTML+=`<p class='text-lg text-center'>${itemInfo}</p>`}))}function showModal(id){closeModal();new bootstrap.Modal(id).show(),closeMenu(),modalState=1}function closeModal(){document.querySelectorAll(".modal").forEach((m=>{let myModal=bootstrap.Modal.getInstance(m);myModal&&myModal.hide()}));const hintTextElement=document.querySelector(".hint-text .text");hintTextElement&&(hintTextElement.textContent="按住螢幕滑動"),modalState=0}function isURL(str){return/^(ftp|http|https):\/\/[^ "]+$/.test(str)}function isImageURL(str){return/\.(jpeg|jpg|gif|png|webp)$/i.test(str)}function getRandom(x){return Math.floor(Math.random()*x)+1}rangeWrapper.addEventListener("mousedown",mouseDown),rangeWrapper.addEventListener("touchstart",mouseDown),rangeWrapper.addEventListener("mousemove",mouseMove),rangeWrapper.addEventListener("touchmove",mouseMove),rangeWrapper.addEventListener("mouseup",mouseUp),rangeWrapper.addEventListener("mouseleave",mouseUp),rangeWrapper.addEventListener("touchend",mouseUp);